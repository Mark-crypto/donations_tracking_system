<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="../stylesheets/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" 
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js" 
    integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.6.1.js" 
    integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css">
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    
    <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"></script>
    <style>
        #sample_data {
          font-family: Arial, Helvetica, sans-serif;
          border-collapse: collapse;
          width: 100%;
        }
        
        #sample_data td, #sample_data th {
          border: 1px solid #ddd;
          padding: 8px;
        }
        
        #sample_data tr:nth-child(even){background-color: #f2f2f2;}
        
        #sample_data tr:hover {background-color: #ddd;}
        
        #sample_data th {
          padding-top: 12px;
          padding-bottom: 12px;
          text-align: left;
          background-color: #04AA6D;
          color: white;
          
        }
        .edit{
            background-color: #04AA6D;
            color: white;
            border: none;
            border-radius: 8px;
            width: 80px;
        }
        .delete{
            background-color: red;
            color: white;
            border: none;
            border-radius: 8px;
            width: 80px;
        }
       
#sample_form input{
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

#action_button {
  width: 100%;
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

#action_button:hover {
  background-color: #45a049;
}

#sample_form {
  
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}

        </style>
    <title>Document</title>
</head>
<body>
    <h1 style="color: green; text-align:center;text-decoration:underline;">ADD DONATION ITEMS</h1>

    
    <!--Download body parser and json2csv module-->
    <a href="/sample_data/export"><button style="height: 40px; width:180px; background-color:#04AA6D; border: none; border-radius: 8px; color: white; font-weight: bold;">Download csv file</button></a><br><br>
    <span id="message" style="color: green; font-weight:bolder"></span>
    <table id="sample_data" >
        <thead>
            <tr>
                <th>Item</th>
                <th>Total Number(Bags)</th>
                <th>Dispatch</th>
                <th>Destination</th>
                <th>Month</th>
                <th>Region</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <h1 style="color: green; text-align:center;text-decoration:underline; padding-top: 20px;">ENTER DATA</h1>
    <!--<button type="button" id="add_data">Add</button>-->
    <form id="sample_form" method="post">
        <label for="">Item</label><br>
        <input type="text" name="name" id="name" required><br>
        <label for="">Total Number(Bags)</label><br>
        <input type="number" name="totalNumber" id="totalNumber" required><br>
        <label for="">Dispatch</label><br>
        <input type="text" name="dispatch" id="dispatch" required><br>
        <label for="">Destination</label><br>
        <input type="text" name="destination" id="destination" required><br>
        <label for="">Month</label><br>
        <input type="text" name="month" id="month" required><br>
        <label for="">Region</label><br>
        <input type="text" name="region" id="region" required><br>

        <input type="hidden" name="id" id="id">
        <input type="hidden" name="action" id="action" value="Add">
        <!--<button type="button" id="action_button">Add</button>-->
        <button id="action_button">add</button>
    </form>
    <script>
        $(document).ready(function() {
            load_data();
            function load_data() {
               $.ajax({
                url:'http://localhost:3000/sample_data/action',
                method:'POST',
                data:{action:'fetch'},
                dataType:'JSON',
                success: function (data) {
                    var html = ''
                    if (data.data.length>0) {
                        for(var count=0; count<data.data.length; count++){
                            html +=`
                            <tr>
                                <td>`+data.data[count].name+`</td>
                                <td>`+data.data[count].totalNumber+`</td>
                                <td>`+data.data[count].dispatch+`</td>
                                <td>`+data.data[count].destination+`</td>
                                <td>`+ data.data[count].month+`</td>
                                <td>`+ data.data[count].region+`</td>
                                <td><button type = "button" class = "edit" data-id="`+data.data[count].id+`">Edit</button> 
                                    <button type = "button" class = "delete" data-id="`+data.data[count].id+`">Delete</button></td>
                            </tr>`
                        }
                    }
                    $('#sample_data tbody').html(html);
                }
               }) 
            }
            $('#sample_form')[0].reset();
            $('#action').val('Add')
            $('#action_button').text('Add')
            $('#sample_form').on('submit', function(event){
                event.preventDefault();

                $.ajax({
                    url:'http://localhost:3000/sample_data/action',
                    method:'POST',
                    data:$('#sample_form').serialize(),
                    dataType:'JSON',
                    beforeSend:function(){
                        $('#action_button').attr('disable','disabled')
                    },
                    success:function(data){
                        $('#action_button').attr('disabled', false);
                        $('#message').html('<div>'+data.success+'</div>');
                        load_data()

                        setTimeout(function(){
                            $('#message').html('')
                        }, 5000)
                    }
                })
            })
            $(document).on('click','.edit',function () {
                var id = $(this).data('id')

                $('#action').val('Edit')
                $('#action_button').text('Edit')
                

                $.ajax({
                    url:"http://localhost:3000/sample_data/action",
                    method:"POST",
                    data:{
                        id:id,
                        action:'fetch_single'
                    },
                    dataType:"JSON",
                    success:(data)=>{
                        $('#name').val(data.name)
                        $('#totalNumber').val(data.totalNumber)
                        $('#dispatch').val(data.dispatch)
                        $('#destination').val(data.destination)
                        $('#month').val(data.month)
                        $('#region').val(data.region)
                        $('#id').val(data.id)
                    }

                })
            })
        
            $(document).on('click','.delete',function () {
                    var id = $(this).data('id')
                if (confirm("Are you sure you want to delete this data? ")) {
                    $.ajax({
                        url:"http://localhost:3000/sample_data/action",
                        method:"POST",
                        data:{
                            action:'delete',
                            id:id
                    },
                        dataType:"JSON",
                        success:function(data){
                            $('#message').html('<div>'+data.message+'</div>')
                            load_data()

                            setTimeout(function () {
                                $('#message').html('')
                            }, 5000)
                        }

                    })
                }
                })

        })
    </script>











</body>
</html>

